<html><head><base href="https://websim.example.com/bankroll-tracker/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Suivi de Bankroll Poker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
    }
    .navbar {
      background-color: #2c3e50;
    }
    .navbar-brand {
      color: #ecf0f1 !important;
    }
    .card {
      border-radius: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background-color: #3498db;
      border-color: #3498db;
    }
    .btn-primary:hover {
      background-color: #2980b9;
      border-color: #2980b9;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="#">Suivi de Bankroll Poker</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showDashboard()">Tableau de bord</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showBankrollManagement()">Gestion des bankrolls</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showSessionManagement()">Gestion des sessions</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="showRanking()">Classement</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" id="loginLogout" onclick="toggleLoginLogout()">Connexion</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <div id="content"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let currentUser = null;
    const users = [];
    const rooms = ['Winamax', 'Unibet', 'PMU', 'PokerStars', 'PartyPoker', 'Betclic', 'FDJ'];

    function showDashboard() {
      if (!currentUser) {
        showLoginForm();
        return;
      }
      const content = document.getElementById('content');
      content.innerHTML = `
        <h2>Tableau de bord de ${currentUser.username}</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="card mb-4">
              <div class="card-body">
                <h5 class="card-title">Évolution de la bankroll</h5>
                <canvas id="bankrollChart"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card mb-4">
              <div class="card-body">
                <h5 class="card-title">Résumé des bankrolls</h5>
                <ul id="bankrollSummary" class="list-group list-group-flush"></ul>
              </div>
            </div>
          </div>
        </div>
      `;
      updateBankrollChart();
      updateBankrollSummary();
    }

    function showBankrollManagement() {
      if (!currentUser) {
        showLoginForm();
        return;
      }
      const content = document.getElementById('content');
      content.innerHTML = `
        <h2>Gestion des bankrolls</h2>
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Créer une nouvelle bankroll</h5>
            <form onsubmit="createBankroll(event)">
              <div class="mb-3">
                <label for="room" class="form-label">Salle de poker</label>
                <select id="room" class="form-select" required>
                  ${rooms.map(room => `<option value="${room}">${room}</option>`).join('')}
                </select>
              </div>
              <div class="mb-3">
                <label for="initialAmount" class="form-label">Montant initial</label>
                <input type="number" class="form-control" id="initialAmount" step="0.01" required>
              </div>
              <div class="mb-3">
                <label for="startDate" class="form-label">Date de création</label>
                <input type="date" class="form-control" id="startDate" required>
              </div>
              <button type="submit" class="btn btn-primary">Créer</button>
            </form>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Bankrolls existantes</h5>
            <ul id="existingBankrolls" class="list-group list-group-flush"></ul>
          </div>
        </div>
      `;
      updateExistingBankrolls();
    }

    function showSessionManagement() {
      if (!currentUser) {
        showLoginForm();
        return;
      }
      const content = document.getElementById('content');
      content.innerHTML = `
        <h2>Gestion des sessions</h2>
        <div class="card mb-4">
          <div class="card-body">
            <h5 class="card-title">Ajouter une nouvelle session</h5>
            <form onsubmit="addSession(event)">
              <div class="mb-3">
                <label for="sessionRoom" class="form-label">Salle de poker</label>
                <select id="sessionRoom" class="form-select" required>
                  ${rooms.map(room => `<option value="${room}">${room}</option>`).join('')}
                </select>
              </div>
              <div class="mb-3">
                <label for="sessionDate" class="form-label">Date de la session</label>
                <input type="date" class="form-control" id="sessionDate" required>
              </div>
              <div class="mb-3">
                <label for="mttCount" class="form-label">Nombre de MTT joués</label>
                <input type="number" class="form-control" id="mttCount" required>
              </div>
              <div class="mb-3">
                <label for="buyInTotal" class="form-label">Total des buy-in</label>
                <input type="number" class="form-control" id="buyInTotal" step="0.01" required>
              </div>
              <div class="mb-3">
                <label for="endBankroll" class="form-label">Bankroll de fin de session</label>
                <input type="number" class="form-control" id="endBankroll" step="0.01" required>
              </div>
              <button type="submit" class="btn btn-primary">Ajouter</button>
            </form>
          </div>
        </div>
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Historique des sessions</h5>
            <ul id="sessionHistory" class="list-group list-group-flush"></ul>
          </div>
        </div>
      `;
      updateSessionHistory();
    }

    function showRanking() {
      const content = document.getElementById('content');
      content.innerHTML = `
        <h2>Classement des joueurs</h2>
        <div class="card">
          <div class="card-body">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Position</th>
                  <th>Joueur</th>
                  <th>Évolution totale (%)</th>
                </tr>
              </thead>
              <tbody id="rankingTable"></tbody>
            </table>
          </div>
        </div>
      `;
      updateRanking();
    }

    function showLoginForm() {
      const content = document.getElementById('content');
      content.innerHTML = `
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Connexion</h5>
                <form onsubmit="login(event)">
                  <div class="mb-3">
                    <label for="username" class="form-label">Nom d'utilisateur</label>
                    <input type="text" class="form-control" id="username" required>
                  </div>
                  <div class="mb-3">
                    <label for="password" class="form-label">Mot de passe</label>
                    <input type="password" class="form-control" id="password" required>
                  </div>
                  <button type="submit" class="btn btn-primary">Se connecter</button>
                </form>
                <hr>
                <p>Pas encore de compte ? <a href="#" onclick="showRegisterForm()">S'inscrire</a></p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function showRegisterForm() {
      const content = document.getElementById('content');
      content.innerHTML = `
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">Inscription</h5>
                <form onsubmit="register(event)">
                  <div class="mb-3">
                    <label for="newUsername" class="form-label">Nom d'utilisateur</label>
                    <input type="text" class="form-control" id="newUsername" required>
                  </div>
                  <div class="mb-3">
                    <label for="newPassword" class="form-label">Mot de passe</label>
                    <input type="password" class="form-control" id="newPassword" required>
                  </div>
                  <div class="mb-3">
                    <label for="confirmPassword" class="form-label">Confirmer le mot de passe</label>
                    <input type="password" class="form-control" id="confirmPassword" required>
                  </div>
                  <button type="submit" class="btn btn-primary">S'inscrire</button>
                </form>
                <hr>
                <p>Déjà un compte ? <a href="#" onclick="showLoginForm()">Se connecter</a></p>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function login(event) {
      event.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const user = users.find(u => u.username === username && u.password === password);
      if (user) {
        currentUser = user;
        document.getElementById('loginLogout').textContent = 'Déconnexion';
        showDashboard();
      } else {
        alert('Nom d\'utilisateur ou mot de passe incorrect.');
      }
    }

    function register(event) {
      event.preventDefault();
      const username = document.getElementById('newUsername').value;
      const password = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      if (password !== confirmPassword) {
        alert('Les mots de passe ne correspondent pas.');
        return;
      }
      if (users.some(u => u.username === username)) {
        alert('Ce nom d\'utilisateur est déjà pris.');
        return;
      }
      const newUser = {
        username,
        password,
        bankrolls: [],
        sessions: []
      };
      users.push(newUser);
      currentUser = newUser;
      document.getElementById('loginLogout').textContent = 'Déconnexion';
      showDashboard();
    }

    function logout() {
      currentUser = null;
      document.getElementById('loginLogout').textContent = 'Connexion';
      showLoginForm();
    }

    function toggleLoginLogout() {
      if (currentUser) {
        logout();
      } else {
        showLoginForm();
      }
    }

    function createBankroll(event) {
      event.preventDefault();
      const room = document.getElementById('room').value;
      const initialAmount = parseFloat(document.getElementById('initialAmount').value);
      const startDate = document.getElementById('startDate').value;
      if (currentUser.bankrolls.some(b => b.room === room)) {
        if (confirm(`Vous avez déjà une bankroll pour ${room}. Voulez-vous la remplacer ?`)) {
          currentUser.bankrolls = currentUser.bankrolls.filter(b => b.room !== room);
        } else {
          return;
        }
      }
      currentUser.bankrolls.push({ room, initialAmount, startDate, currentAmount: initialAmount });
      updateExistingBankrolls();
      alert('Bankroll créée avec succès.');
    }

    function updateExistingBankrolls() {
      const existingBankrollsList = document.getElementById('existingBankrolls');
      existingBankrollsList.innerHTML = currentUser.bankrolls.map(bankroll => `
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${bankroll.room} - Montant initial: ${bankroll.initialAmount.toFixed(2)} € - Montant actuel: ${bankroll.currentAmount.toFixed(2)} €
          <button class="btn btn-danger btn-sm" onclick="deleteBankroll('${bankroll.room}')">Supprimer</button>
        </li>
      `).join('');
    }

    function deleteBankroll(room) {
      if (confirm(`Êtes-vous sûr de vouloir supprimer la bankroll pour ${room} ?`)) {
        currentUser.bankrolls = currentUser.bankrolls.filter(b => b.room !== room);
        updateExistingBankrolls();
      }
    }

    function addSession(event) {
      event.preventDefault();
      const room = document.getElementById('sessionRoom').value;
      const date = document.getElementById('sessionDate').value;
      const mttCount = parseInt(document.getElementById('mttCount').value);
      const buyInTotal = parseFloat(document.getElementById('buyInTotal').value);
      const endBankroll = parseFloat(document.getElementById('endBankroll').value);
      const bankroll = currentUser.bankrolls.find(b => b.room === room);
      if (!bankroll) {
        alert(`Vous n'avez pas de bankroll pour ${room}. Veuillez en créer une d'abord.`);
        return;
      }
      currentUser.sessions.push({ room, date, mttCount, buyInTotal, endBankroll });
      bankroll.currentAmount = endBankroll;
      updateSessionHistory();
      alert('Session ajoutée avec succès.');
    }

    function updateSessionHistory() {
      const sessionHistoryList = document.getElementById('sessionHistory');
      sessionHistoryList.innerHTML = currentUser.sessions.map((session, index) => `
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${session.date} - ${session.room} - MTT: ${session.mttCount} - Buy-in: ${session.buyInTotal.toFixed(2)} € - Fin: ${session.endBankroll.toFixed(2)} €
          <button class="btn btn-danger btn-sm" onclick="deleteSession(${index})">Supprimer</button>
        </li>
      `).join('');
    }

    function deleteSession(index) {
      if (confirm('Êtes-vous sûr de vouloir supprimer cette session ?')) {
        currentUser.sessions.splice(index, 1);
        updateSessionHistory();
      }
    }

    function updateBankrollChart() {
      const ctx = document.getElementById('bankrollChart').getContext('2d');
      const labels = currentUser.bankrolls.map(b => b.room);
      const initialData = currentUser.bankrolls.map(b => b.initialAmount);
      const currentData = currentUser.bankrolls.map(b => b.currentAmount);
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Montant initial',
              data: initialData,
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            },
            {
              label: 'Montant actuel',
              data: currentData,
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }

    function updateBankrollSummary() {
      const bankrollSummaryList = document.getElementById('bankrollSummary');
      bankrollSummaryList.innerHTML = currentUser.bankrolls.map(bankroll => `
        <li class="list-group-item d-flex justify-content-between align-items-center">
          ${bankroll.room}
          <span>
            Initial: ${bankroll.initialAmount.toFixed(2)} € | 
            Actuel: ${bankroll.currentAmount.toFixed(2)} € | 
            Évolution: ${((bankroll.currentAmount - bankroll.initialAmount) / bankroll.initialAmount * 100).toFixed(2)}%
          </span>
        </li>
      `).join('');
    }

    function updateRanking() {
      const rankingTable = document.getElementById('rankingTable');
      const ranking = users.map(user => {
        const totalInitial = user.bankrolls.reduce((sum, b) => sum + b.initialAmount, 0);
        const totalCurrent = user.bankrolls.reduce((sum, b) => sum + b.currentAmount, 0);
        const evolution = (totalCurrent - totalInitial) / totalInitial * 100;
        return { username: user.username, evolution };
      }).sort((a, b) => b.evolution - a.evolution);

      rankingTable.innerHTML = ranking.map((player, index) => `
        <tr>
          <td>${index + 1}</td>
          <td>${player.username}</td>
          <td>${player.evolution.toFixed(2)}%</td>
        </tr>
      `).join('');
    }

    // Initialize the app
    showLoginForm();
  </script>
</body>
</html>